#!/usr/bin/env bash
#
# Remove files from a GIT repository.
# Copyright (c) Petr Baudis, 2005
#
# Takes a list of file names at the command line, and schedules them
# for removal from the GIT repository at the next commit.
#
# OPTIONS
# -------
# -n::
#	Do not delete the files from the tree physically, if they are
#	still there. So it effectively just makes Cogito to stop caring
#	about the file.

USAGE="cg-rm [-n] FILE..."

. ${COGITO_LIB}cg-Xlib || exit 1

no_delete=
if [ "$1" = "-n" ]; then
	no_delete=1
	shift
fi

[ "$1" ] || usage

TMPFILE=$(mktemp -t gitrm.XXXXXX) || exit 1
for file in "$@"; do
	echo "${_git_relpath}$file" >>$TMPFILE
done

cat $TMPFILE | sed 's/^/Removing file /'
[ "$no_delete" ] || ( cd ${_git_relpath:-.} && rm -f "$@" )
cat $TMPFILE | normpath | tr '\n' '\0' | xargs -0 git-update-cache --force-remove --

rm $TMPFILE
