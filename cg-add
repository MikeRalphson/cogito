#!/usr/bin/env bash
#
# Add files to the GIT repository.
# Copyright (c) Petr Baudis, 2005
#
# Takes a list of file names at the command line, and schedules them
# for addition to the GIT repository at the next commit.
#
# The command will fail if one of the given files does not exist.
#
# Note that directories never have to be added to the repository and any
# attempt in doing so will cause the command to fail. The reason for this
# is that 'Cogito' manages content and empty directories have no content.
# Instead, directories are added automatically when adding files inside
# them.

USAGE="cg-add FILE..."

. ${COGITO_LIB}cg-Xlib

[ "$1" ] || usage

TMPFILE=$(mktemp -t gitadd.XXXXXX) || exit 1
( cd ${_git_relpath:-.} && find "$@" -type f -print ) > $TMPFILE || {
	die "not all files exist, nothing added"
	rm $TMPFILE
}

cat $TMPFILE | sed 's/^/Adding file /'
cat $TMPFILE | sed "s|^|${_git_relpath:-.}/|" | normpath | tr '\n' '\0' | xargs -0r git-update-cache --add --

rm $TMPFILE
